<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>太平年·五代十国百题考</title>
    <style>
        /* --- 1. 全局与纹理系统 --- */
        :root {
            --paper-base: #f4e8d1;
            --ink-main: #2b2b2b;
            --ink-light: rgba(43, 43, 43, 0.6);
            --seal-red: #b22222;
            --wood-frame: #5d4037;
            --gold-accent: #cfb058;
        }

        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; }

        body {
            margin: 0; padding: 0;
            height: 100vh;
            overflow: hidden;
            background-color: var(--paper-base);
            /* 噪点纹理，模拟宣纸质感 */
            background-image: url("data:image/svg+xml,%3Csvg viewBox='0 0 200 200' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='noiseFilter'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.65' numOctaves='3' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23noiseFilter)' opacity='0.1'/%3E%3C/svg%3E");
            font-family: "KaiTi", "STKaiti", "BiauKai", serif;
            color: var(--ink-main);
            display: flex;
            justify-content: center;
            align-items: center;
        }

        /* --- 2. 主容器：卷轴风格 --- */
        .container {
            width: 92%;
            max-width: 480px;
            height: 94vh;
            border: 3px double var(--wood-frame);
            border-radius: 6px;
            position: relative;
            background: rgba(255, 255, 255, 0.4);
            box-shadow: 0 0 15px rgba(93, 64, 55, 0.3);
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }

        /* 装饰角 */
        .corner {
            position: absolute;
            width: 30px; height: 30px;
            border: 3px solid var(--wood-frame);
            z-index: 2;
        }
        .tl { top: 6px; left: 6px; border-right: 0; border-bottom: 0; }
        .tr { top: 6px; right: 6px; border-left: 0; border-bottom: 0; }
        .bl { bottom: 6px; left: 6px; border-right: 0; border-top: 0; }
        .br { bottom: 6px; right: 6px; border-left: 0; border-top: 0; }

        /* --- 3. 屏幕切换逻辑 --- */
        .screen {
            flex: 1;
            display: none;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 20px;
            width: 100%;
            opacity: 0;
            transition: opacity 0.5s ease;
        }
        .screen.active { display: flex; opacity: 1; }

        /* --- 4. 首页元素 --- */
        .main-title {
            font-size: 2.8rem;
            writing-mode: vertical-rl;
            letter-spacing: 0.5rem;
            border-left: 4px solid var(--seal-red);
            padding-left: 20px;
            margin-bottom: 30px;
            font-weight: bold;
            text-shadow: 2px 2px 0 rgba(178,34,34,0.1);
        }
        
        .sub-title {
            font-size: 1.1rem;
            color: var(--wood-frame);
            margin-bottom: 40px;
            border-top: 1px solid var(--wood-frame);
            border-bottom: 1px solid var(--wood-frame);
            padding: 10px 0;
            width: 60%;
            text-align: center;
        }

        /* 水墨按钮 */
        .ink-btn {
            background: transparent;
            border: 2px solid var(--ink-main);
            padding: 12px 40px;
            font-size: 1.3rem;
            font-family: inherit;
            font-weight: bold;
            cursor: pointer;
            position: relative;
            overflow: hidden;
            transition: all 0.3s;
            z-index: 10;
        }
        .ink-btn::before {
            content: '';
            position: absolute;
            top: 0; left: -100%;
            width: 100%; height: 100%;
            background: var(--ink-main);
            transition: all 0.4s;
            z-index: -1;
            opacity: 0.1;
        }
        .ink-btn:active { transform: scale(0.96); }

        /* --- 5. 答题页元素 --- */
        .progress-container {
            width: 100%;
            height: 4px;
            background: rgba(93, 64, 55, 0.1);
            margin-bottom: 20px;
            position: relative;
        }
        .progress-ink {
            height: 100%;
            background: var(--wood-frame);
            width: 0%;
            transition: width 0.5s cubic-bezier(0.25, 1, 0.5, 1);
        }
        
        .question-card {
            width: 100%;
            min-height: 100px;
            font-size: 1.25rem;
            line-height: 1.6;
            text-align: justify;
            margin-bottom: 25px;
            font-weight: bold;
        }

        .options-list { width: 100%; flex: 1; overflow-y: auto; }

        .option-item {
            position: relative;
            padding: 15px;
            margin-bottom: 12px;
            border: 1px solid var(--wood-frame);
            background: rgba(255,255,255,0.7);
            font-size: 1.1rem;
            display: flex;
            align-items: flex-start;
            cursor: pointer;
            overflow: hidden; /* 关键：用于限制墨水动画 */
            transition: border-color 0.2s;
        }

        .option-tag {
            font-weight: bold;
            margin-right: 12px;
            color: var(--seal-red);
        }

        /* 水墨晕开动画特效 */
        .ripple {
            position: absolute;
            background: rgba(43, 43, 43, 0.15);
            border-radius: 50%;
            transform: scale(0);
            animation: ripple-anim 0.6s linear;
            pointer-events: none;
        }
        @keyframes ripple-anim {
            to { transform: scale(4); opacity: 0; }
        }

        /* --- 6. 结果页（通关文牒风） --- */
        .result-card {
            width: 100%;
            padding: 20px;
            border: 2px solid var(--wood-frame);
            background: #fff;
            position: relative;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
            text-align: center;
            margin-bottom: 20px;
            background-image: repeating-linear-gradient(transparent, transparent 29px, rgba(0,0,0,0.05) 30px);
        }

        /* 拟真印章 - 不规则形状 */
        .seal-mark {
            width: 100px; height: 100px;
            border: 3px solid var(--seal-red);
            color: var(--seal-red);
            display: flex; justify-content: center; align-items: center;
            font-size: 1.6rem; font-weight: bold;
            position: absolute; top: -15px; right: -15px;
            transform: rotate(15deg);
            border-radius: 40% 60% 70% 30% / 40% 50% 60% 50%; /* 不规则圆角 */
            background: rgba(178, 34, 34, 0.05);
            box-shadow: inset 0 0 5px rgba(178,34,34,0.2);
            z-index: 5;
            animation: stamp-anim 0.5s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        }
        @keyframes stamp-anim { from { transform: scale(2) rotate(0); opacity: 0; } to { transform: scale(1) rotate(15deg); opacity: 1; } }

        .score-num { font-size: 4rem; color: var(--seal-red); font-weight: bold; margin: 10px 0; font-family: "Courier New", serif; }
        .comment-text { font-size: 1.1rem; margin-bottom: 15px; line-height: 1.5; text-align: justify; }
        .tag-text { font-size: 0.9rem; color: #666; font-style: italic; border-top: 1px dashed #ccc; padding-top: 10px; }

        .action-area { width: 100%; display: flex; flex-direction: column; gap: 10px; }
        .secondary-btn { font-size: 1rem; padding: 10px; border: 1px dashed var(--ink-main); color: var(--ink-main); background: transparent; }

        /* --- 7. 错题弹窗 --- */
        .modal {
            position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(244, 232, 209, 0.95);
            z-index: 100;
            display: none;
            flex-direction: column;
            padding: 20px;
        }
        .modal.open { display: flex; animation: slideUp 0.3s; }
        .modal-header { font-size: 1.5rem; font-weight: bold; margin-bottom: 20px; text-align: center; border-bottom: 2px solid var(--wood-frame); padding-bottom: 10px;}
        .review-list { flex: 1; overflow-y: auto; }
        .review-item { margin-bottom: 15px; padding-bottom: 15px; border-bottom: 1px dashed #ccc; }
        .review-q { font-weight: bold; margin-bottom: 5px; }
        .review-wrong { color: var(--seal-red); font-size: 0.95rem; }
        .review-right { color: green; font-size: 0.95rem; font-weight: bold; }
        .close-btn { margin-top: 10px; background: var(--wood-frame); color: #fff; border: none; padding: 12px; font-size: 1.1rem; }

        @keyframes slideUp { from { transform: translateY(100%); } to { transform: translateY(0); } }

    </style>
</head>
<body>

<div class="container">
    <div class="corner tl"></div><div class="corner tr"></div>
    <div class="corner bl"></div><div class="corner br"></div>

    <!-- 首页 -->
    <div id="screen-start" class="screen active">
        <h1 class="main-title">太平年<br>风云考</h1>
        <div class="sub-title">一百题库 · 智能分卷 · 错题复盘</div>
        <button class="ink-btn" onclick="game.start()">开卷有益</button>
    </div>

    <!-- 答题页 -->
    <div id="screen-quiz" class="screen">
        <div class="progress-container">
            <div class="progress-ink" id="progress-bar"></div>
        </div>
        <div style="width:100%; text-align:right; font-size:0.9rem; color:#666; margin-bottom:5px;">
            第 <span id="q-curr">1</span>/10 题
        </div>
        <div class="question-card" id="q-text">题目加载中...</div>
        <div class="options-list" id="q-options"></div>
    </div>

    <!-- 结果页 -->
    <div id="screen-result" class="screen">
        <div class="result-card">
            <div class="seal-mark" id="res-seal">通关</div>
            <div>太平年·御前殿试</div>
            <div class="score-num" id="res-score">0</div>
            <div class="comment-text" id="res-comment"></div>
            <div class="tag-text" id="res-tag"></div>
        </div>
        
        <div class="action-area">
            <button class="ink-btn" onclick="game.start()">再战乱世</button>
            <button class="secondary-btn" id="btn-review" onclick="game.showReview()" style="display:none;">温故知新 (查看错题)</button>
        </div>
        <div style="margin-top:15px; font-size:0.8rem; color:#888;">长按截图分享，寻找乱世知音</div>
    </div>

    <!-- 错题复盘弹窗 -->
    <div id="modal-review" class="modal">
        <div class="modal-header">错题复盘</div>
        <div class="review-list" id="review-content"></div>
        <button class="close-btn" onclick="document.getElementById('modal-review').classList.remove('open')">返回</button>
    </div>
</div>

<script>
    // --- 题库数据 (100题) ---
    // c: 1=背景(0-24), 2=吴越(25-49), 3=大宋(50-74), 4=文化(75-99)
    const rawData = [
        // 1-25 背景
        {q: "电视剧《太平年》的故事主要发生在哪个历史时期？", o: ["春秋战国", "三国时期", "五代十国末期至北宋初年", "元末明初"], a: 2, c: 1},
        {q: "“五代十国”中的“五代”不包括以下哪一个政权？", o: ["后梁", "后唐", "后晋", "后燕"], a: 3, c: 1},
        {q: "五代十国时期，中原政权的都城大多设在何处？", o: ["长安", "洛阳或汴州", "建康", "燕京"], a: 1, c: 1},
        {q: "中国处于大分裂状态，这种局面是从哪个事件后逐渐形成的？", o: ["八王之乱", "安史之乱与藩镇割据", "靖康之耻", "土木堡之变"], a: 1, c: 1},
        {q: "《太平年》剧名中的“太平”，在当时语境下主要意味着什么？", o: ["经济繁荣", "文化开放", "结束战乱，天下一统", "疆域最大"], a: 2, c: 1},
        {q: "哪个成语最适合形容五代十国时期的政权更迭？", o: ["走马观花", "沧海桑田", "城头变幻大王旗", "纸上谈兵"], a: 2, c: 1},
        {q: "剧中出现的“十国”大多分布在中国的哪个地理区域？", o: ["东北地区", "西北地区", "南方地区", "华北平原"], a: 2, c: 1},
        {q: "终结五代十国分裂局面，最终建立北宋政权的开国皇帝是？", o: ["柴荣", "赵匡胤", "赵光义", "李煜"], a: 1, c: 1},
        {q: "五代建立后周政权，为北宋统一打下基础的杰出君主是？", o: ["郭威", "柴荣", "石敬瑭", "刘知远"], a: 1, c: 1},
        {q: "石敬瑭为了借兵，将哪一片重要的战略要地割让给了契丹？", o: ["河西走廊", "燕云十六州", "辽东半岛", "关中平原"], a: 1, c: 1},
        {q: "“燕云十六州”的丢失对后世哪个朝代的边防造成了致命威胁？", o: ["唐朝", "宋朝", "元朝", "清朝"], a: 1, c: 1},
        {q: "乱世中军阀混战，武将专权。当时形容这种现象的俗语是？", o: ["天子宁有种乎，兵强马壮者为之", "王侯将相宁有种乎", "苍天已死", "莫须有"], a: 0, c: 1},
        {q: "北宋建立的年份是哪一年？", o: ["907年", "960年", "979年", "1127年"], a: 1, c: 1},
        {q: "在五代十国时期，契丹族建立的强大政权是？", o: ["辽", "金", "西夏", "蒙古"], a: 0, c: 1},
        {q: "五代十国时期，社会动荡导致了大量人口迁徙，主要方向是？", o: ["由南向北", "由北向南", "由东向西", "由西向东"], a: 1, c: 1},
        {q: "下列哪一部史书是研究五代历史的最重要史料之一？", o: ["《史记》", "《汉书》", "《新五代史》", "《明史》"], a: 2, c: 1},
        {q: "五代十国时期，哪项技术广泛应用促进了文化传播？", o: ["造纸术", "雕版印刷术", "活字印刷术", "指南针"], a: 1, c: 1},
        {q: "“乱世终局”标志着中国古代历史从割据走向了哪个朝代的集权？", o: ["隋朝", "唐朝", "宋朝", "明朝"], a: 2, c: 1},
        {q: "北宋初年，为防止唐末五代以来的武将专政，采取了什么国策？", o: ["穷兵黩武", "崇文抑武", "闭关锁国", "和亲政策"], a: 1, c: 1},
        {q: "剧中表现的历史时期，南方经济超过北方，这一进程被称为？", o: ["经济重心南移", "丝绸之路开辟", "摊丁入亩", "洋务运动"], a: 0, c: 1},
        {q: "五代十国时期，哪种文学体裁逐渐兴盛并在宋代达到顶峰？", o: ["汉赋", "唐诗", "词", "元曲"], a: 2, c: 1},
        {q: "后周世宗柴荣在位期间进行了多项改革，其中不包括？", o: ["澄清吏治", "废除科举", "灭佛兴学", "发展商业"], a: 1, c: 1},
        {q: "五代十国的“十国”中，唯一一个地处北方的政权是？", o: ["前蜀", "南吴", "北汉", "南楚"], a: 2, c: 1},
        {q: "剧中还原的“舂磨砦”反映了当时的什么悲惨现象？", o: ["赋税沉重", "军队以人为食", "酷刑泛滥", "瘟疫流行"], a: 1, c: 1},
        {q: "能够准确概括《太平年》历史主旨的词语是？", o: ["争权夺利", "走向统一", "盛极而衰", "变法图强"], a: 1, c: 1},

        // 26-50 吴越
        {q: "钱弘俶是十国中哪个国家的君主？", o: ["南唐", "吴越国", "闽国", "南汉"], a: 1, c: 2},
        {q: "吴越国的建立者，也是钱弘俶的祖先是？", o: ["钱镠", "钱元瓘", "钱佐", "钱倧"], a: 0, c: 2},
        {q: "吴越国的都城设在今天的哪座城市？", o: ["苏州", "杭州", "南京", "福州"], a: 1, c: 2},
        {q: "吴越国在五代十国时期采取的基本国策是？", o: ["远交近攻", "善事中国（保境安民）", "闭关自守", "联辽抗宋"], a: 1, c: 2},
        {q: "“纳土归宋”指的是谁将领土和平交给了宋朝？", o: ["李煜", "钱弘俶", "刘鋹", "孟昶"], a: 1, c: 2},
        {q: "吴越国“纳土归宋”避免了什么悲惨结局？", o: ["国家破产", "战火波及江南百姓", "外族入侵", "内部叛乱"], a: 1, c: 2},
        {q: "钱镠遗训告诫子孙在遇到“真主”时应当如何？", o: ["殊死抵抗", "割据称帝", "纳土归降，不可兴兵", "逃亡海外"], a: 2, c: 2},
        {q: "吴越国在统治期间，对杭州地区最大的水利贡献是？", o: ["开凿大运河", "修筑海塘", "治理黄河", "修建都江堰"], a: 1, c: 2},
        {q: "杭州西湖边的“保俶塔”，与哪位历史人物的祈福有关？", o: ["苏轼", "钱弘俶", "岳飞", "白居易"], a: 1, c: 2},
        {q: "钱弘俶纳土归宋后，被宋朝封为什么王？", o: ["楚王", "秦王", "吴越国王/邓王", "晋王"], a: 2, c: 2},
        {q: "钱镠写给夫人的千古名句是？", o: ["执子之手", "陌上花开，可缓缓归矣", "两情若是久长时", "在天愿作比翼鸟"], a: 1, c: 2},
        {q: "吴越国在文化和宗教上极力推崇哪一种信仰？", o: ["道教", "佛教", "伊斯兰教", "景教"], a: 1, c: 2},
        {q: "宋太祖赵匡胤对纳土归宋的钱弘俶态度如何？", o: ["立即处死", "软禁虐待", "优待并赐予荣誉", "流放边疆"], a: 2, c: 2},
        {q: "《百家姓》中“钱”姓排第二的主要历史原因是什么？", o: ["人口最多", "编纂者姓钱", "感念钱氏纳土归宋功绩", "随机排列"], a: 2, c: 2},
        {q: "吴越国的版图大致相当于今天的哪个省份及周边地区？", o: ["浙江省", "广东省", "四川省", "湖南省"], a: 0, c: 2},
        {q: "钱弘俶曾大量印造并藏于雷峰塔内的佛教文物是？", o: ["《金刚经》", "《宝箧印陀罗尼经》", "《法华经》", "《大藏经》"], a: 1, c: 2},
        {q: "面对宋朝压力，南唐君主李煜选择了什么策略？", o: ["主动纳土", "称臣纳贡，但最终城破", "远走高飞", "联合契丹"], a: 1, c: 2},
        {q: "相较于南唐的战败，吴越国的“纳土归宋”被赞誉为？", o: ["忍辱偷生", "和平统一典范，保全江南", "卖国求荣", "迫不得已"], a: 1, c: 2},
        {q: "钱氏家族统治吴越国近百年，被称为“三世几王”？", o: ["三世四王", "三世五王", "两世三王", "四世六王"], a: 1, c: 2},
        {q: "电视剧中展现了吴越国繁荣的经济，其主要支柱是？", o: ["丝绸与海外贸易", "畜牧业", "煤炭开采", "棉花种植"], a: 0, c: 2},
        {q: "赵匡胤派人接收吴越国时，钱弘俶的配合方式是？", o: ["交出所有户口、图籍和军队", "只交出图籍", "要求宋军退出", "要求割地赔款"], a: 0, c: 2},
        {q: "钱弘俶六十八岁生日宴离世，历史上对此的猜测多为？", o: ["战死沙场", "寿终正寝或被毒杀", "遇刺身亡", "溺水而亡"], a: 1, c: 2},
        {q: "《太平年》通过吴越国视角传达的最高历史智慧是？", o: ["宁为玉碎", "识时务，以民生为本", "狡兔死走狗烹", "胜者为王"], a: 1, c: 2},
        {q: "吴越国的“保境安民”使得江南地区成为了什么？", o: ["荒无人烟", "主战场", "经济繁荣的避风港", "难民禁区"], a: 2, c: 2},
        {q: "杭州的哪座著名古塔也是在钱弘俶统治时期修建的？", o: ["六和塔", "雷峰塔", "大雁塔", "铁塔"], a: 1, c: 2},

        // 51-75 大宋
        {q: "赵匡胤在建立宋朝前担任后周的什么重要职务？", o: ["丞相", "殿前都点检", "枢密使", "节度使"], a: 1, c: 3},
        {q: "赵匡胤是通过哪一场著名的兵变建立宋朝的？", o: ["玄武门之变", "马嵬坡之变", "陈桥兵变", "靖难之役"], a: 2, c: 3},
        {q: "陈桥兵变中，将士们将什么颜色的衣服披在赵匡胤身上？", o: ["紫袍", "红袍", "黄袍", "黑袍"], a: 2, c: 3},
        {q: "赵匡胤建立宋朝后，为了统一全国，采取了怎样的战略？", o: ["先北后南", "先南后北", "东西并进", "固守中原"], a: 1, c: 3},
        {q: "赵匡胤为防将领篡位，导演了哪一场著名政治事件？", o: ["火烧庆功楼", "杯酒释兵权", "杀戮功臣", "指鹿为马"], a: 1, c: 3},
        {q: "“杯酒释兵权”主要解除了哪些人的兵权？", o: ["地方藩镇", "禁军高级将领", "宰相", "契丹降将"], a: 1, c: 3},
        {q: "赵匡胤建立的宋朝都城设在哪里？", o: ["长安", "洛阳", "东京汴梁（开封）", "临安"], a: 2, c: 3},
        {q: "赵匡胤在位期间始终未能收复哪片领土，留下了遗憾？", o: ["江南地区", "岭南地区", "燕云十六州", "巴蜀地区"], a: 2, c: 3},
        {q: "剧中赵匡胤的性格设定通常是？", o: ["残暴嗜杀", "懦弱无能", "宽仁大度，深谋远虑", "昏庸好色"], a: 2, c: 3},
        {q: "消灭南唐时，赵匡胤对求和使者说出了哪句霸气之言？", o: ["卧榻之侧，岂容他人鼾睡", "犯我强汉者", "顺我者昌", "朕即国家"], a: 0, c: 3},
        {q: "赵匡胤死后，继承皇位的是谁？", o: ["赵德昭", "赵光义（宋太宗）", "养子", "小儿子"], a: 1, c: 3},
        {q: "赵匡胤的突然离世在历史上留下了什么著名的千古之谜？", o: ["狸猫换太子", "烛影斧声", "靖康之耻", "夺门之变"], a: 1, c: 3},
        {q: "《太平年》中，赵匡胤与钱弘俶的交锋主要体现在什么层面？", o: ["生死决斗", "政治智慧与责任感", "商业贸易", "后宫联姻"], a: 1, c: 3},
        {q: "北宋初年，赵匡胤设置了什么机构来分割宰相的军权？", o: ["三司", "枢密院", "御史台", "尚书省"], a: 1, c: 3},
        {q: "赵匡胤为加强集权，设置了什么官职将地方财政收归中央？", o: ["通判", "转运使", "知州", "节度使"], a: 1, c: 3},
        {q: "剧中北宋初年科举制度改革，最重要的一项是？", o: ["废除武举", "实行殿试", "只考八股文", "允许女子参考"], a: 1, c: 3},
        {q: "赵匡胤立下的“勒石之誓”，要求后代皇帝做到什么？", o: ["必须收复燕云", "不杀士大夫及言事人", "永不和亲", "重用宦官"], a: 1, c: 3},
        {q: "赵匡胤年轻时曾有怎样的经历传说？", o: ["千里走单骑", "千里送京娘", "桃园三结义", "斩白蛇起义"], a: 1, c: 3},
        {q: "赵匡胤的统一战争中，最先灭亡的是哪个十国政权？", o: ["南平（荆南）和武平", "后蜀", "南汉", "南唐"], a: 0, c: 3},
        {q: "花蕊夫人写诗“十四万人齐解甲”，以此讽刺什么？", o: ["宋军太强大", "后蜀将士不战而降", "天气太热", "武器太落后"], a: 1, c: 3},
        {q: "宋军在攻灭南汉时，遇到了什么动物组成的军队？", o: ["象阵", "骑兵", "战车兵", "藤甲兵"], a: 0, c: 3},
        {q: "赵匡胤称帝时，后周的最后一位小皇帝是？", o: ["柴荣", "柴宗训（周恭帝）", "郭威", "郭宗训"], a: 1, c: 3},
        {q: "赵匡胤对待退位后的柴宗训母子态度如何？", o: ["斩草除根", "赐予丹书铁券，优待", "流放海外", "贬为庶人"], a: 1, c: 3},
        {q: "大宋的统一进程体现了哪一种政治理念？", o: ["以德服人与武力并重", "杀戮屠城", "羁縻统治", "分封诸侯"], a: 0, c: 3},
        {q: "赵匡胤的庙号是“太祖”，通常意味着他？", o: ["功劳最大，开创基业", "在位最长", "年纪最大", "最注重文化"], a: 0, c: 3},

        // 76-100 文化
        {q: "《太平年》在制作上号称采用了当时最先进的什么视觉技术？", o: ["3D技术", "VR技术", "8K超高清技术", "胶片拍摄"], a: 2, c: 4},
        {q: "还原古代战败者投降时受到的侮辱性仪式叫什么？", o: ["负荆请罪", "牵羊礼", "三拜九叩", "割发代首"], a: 1, c: 4},
        {q: "五代十国时期的人们在饮茶方面，主要盛行什么方式？", o: ["泡茶法", "煎茶与点茶法", "喝奶茶", "喝冷泡茶"], a: 1, c: 4},
        {q: "北宋初年的城市街景，最可能不同于唐朝长安城的一点是？", o: ["打破坊市限制，有夜市", "全是泥路", "没有外国人", "全是石屋"], a: 0, c: 4},
        {q: "五代吴越国时期达到极高工艺水平，被称为“秘色瓷”的是？", o: ["青花瓷", "越窑青瓷", "汝窑天青釉", "唐三彩"], a: 1, c: 4},
        {q: "钱弘俶在杭州的宫殿建筑风格，最可能体现了什么？", o: ["粗犷北方风格", "江南园林风格", "伊斯兰风格", "藏式风格"], a: 1, c: 4},
        {q: "《太平年》通过展现政权覆灭，揭示了什么历史规律？", o: ["得民心者得天下", "武器先进就能赢", "地理位置决定", "钱多就能赢"], a: 0, c: 4},
        {q: "北宋建立后，为了统一货币，发行的主要铜钱币种是？", o: ["开元通宝", "宋元通宝", "永乐通宝", "乾隆通宝"], a: 1, c: 4},
        {q: "唐宋时期官服通常用什么来区分官员的品级高低？", o: ["衣服的颜色", "帽子的高度", "鞋子的材质", "腰带的重量"], a: 0, c: 4},
        {q: "五代十国时期，百姓常被强行征调去服什么役？", o: ["夫役（沉重劳役）", "讲学", "炼丹", "采珠"], a: 0, c: 4},
        {q: "后周世宗柴荣北伐契丹时，因何原因被迫班师回朝？", o: ["粮草断绝", "突发重病", "遭到伏击", "契丹投降"], a: 1, c: 4},
        {q: "吴越国能够保持长期稳定的一个重要地理屏障是？", o: ["长江与钱塘江天险", "太行山脉", "喜马拉雅山脉", "沙漠"], a: 0, c: 4},
        {q: "被称为“半部论语治天下”的赵匡胤谋士是？", o: ["赵普", "寇准", "范仲淹", "王安石"], a: 0, c: 4},
        {q: "钱镠曾经为了抵御海潮，保护杭州城，留下了什么传说？", o: ["哪吒闹海", "钱王射潮", "精卫填海", "大禹治水"], a: 1, c: 4},
        {q: "钱弘俶交出两浙版图，被后世哪个朝代的帝王高度评价？", o: ["明太祖", "清高宗乾隆", "汉武帝", "唐太宗"], a: 1, c: 4},
        {q: "五代十国时期，南方（如西蜀、南唐）哪项艺术得到了发展？", o: ["绘画（花鸟画）", "京剧", "相声", "油画"], a: 0, c: 4},
        {q: "北宋初年的军队主力被称为？", o: ["八旗军", "禁军", "府兵", "绿营兵"], a: 1, c: 4},
        {q: "《太平年》展现了中华民族历史发展的哪一个核心主题？", o: ["分裂是常态", "走向大一统的必然", "民族虚无", "封建迷信"], a: 1, c: 4},
        {q: "五代时期，历经四朝十帝的不倒翁宰相是？", o: ["魏徵", "冯道", "严嵩", "和珅"], a: 1, c: 4},
        {q: "赵匡胤修建“封桩库”的最初目的是？", o: ["修陵墓", "赎回燕云十六州", "赏赐后宫", "应对饥荒"], a: 1, c: 4},
        {q: "吴越国钱氏家族留下的流传千古的家训是？", o: ["《颜氏家训》", "《钱氏家训》", "《朱子家训》", "《曾国藩家书》"], a: 1, c: 4},
        {q: "南唐后主李煜名句“问君能有几多愁”的下一句是？", o: ["恰似一江春水向东流", "别是一般滋味", "只是朱颜改", "故国不堪回首"], a: 0, c: 4},
        {q: "剧中体现的“纳土归宋”发生在哪一年？", o: ["960年", "978年", "1000年", "1127年"], a: 1, c: 4},
        {q: "五代十国的“十国”中，唯一建立在今天山西一带的政权是？", o: ["北汉", "前蜀", "南楚", "闽国"], a: 0, c: 4},
        {q: "观看《太平年》，我们可以得到的最深刻现实启示是？", o: ["战争是唯一方式", "和平统一与百姓安康", "个人高于国家", "宿命论"], a: 1, c: 4}
    ];

    // --- 游戏控制器 ---
    const game = {
        score: 0,
        idx: 0,
        list: [],
        lock: false,
        stats: {},
        wrongList: [],

        // 辅助：洗牌算法
        shuffle: (arr) => arr.sort(() => Math.random() - 0.5),

        // 核心：分层抽样算法
        generateQuestions: () => {
            // 切割数组：0-24, 25-49, 50-74, 75-99
            const p1 = game.shuffle(rawData.slice(0, 25)).slice(0, 2);  // 背景2题
            const p2 = game.shuffle(rawData.slice(25, 50)).slice(0, 3); // 吴越3题
            const p3 = game.shuffle(rawData.slice(50, 75)).slice(0, 3); // 大宋3题
            const p4 = game.shuffle(rawData.slice(75, 100)).slice(0, 2); // 文化2题
            // 合并后再打乱，避免按顺序出现
            return game.shuffle([...p1, ...p2, ...p3, ...p4]);
        },

        start: () => {
            game.score = 0;
            game.idx = 0;
            game.lock = false;
            game.stats = {1:0, 2:0, 3:0, 4:0};
            game.wrongList = [];
            game.list = game.generateQuestions();
            
            document.getElementById('screen-start').classList.remove('active');
            document.getElementById('screen-result').classList.remove('active');
            document.getElementById('screen-quiz').classList.add('active');
            
            game.render();
        },

        render: () => {
            const q = game.list[game.idx];
            document.getElementById('q-curr').textContent = game.idx + 1;
            document.getElementById('q-text').textContent = q.q;
            document.getElementById('progress-bar').style.width = ((game.idx) / 10 * 100) + '%';
            
            const box = document.getElementById('q-options');
            box.innerHTML = '';
            
            q.o.forEach((txt, i) => {
                const div = document.createElement('div');
                div.className = 'option-item';
                div.innerHTML = `<span class="option-tag">${String.fromCharCode(65+i)}.</span>${txt}`;
                div.onclick = (e) => game.handle(i, div, e);
                box.appendChild(div);
            });
        },

        handle: (choice, el, e) => {
            if(game.lock) return;
            game.lock = true;

            // 水墨扩散特效
            const rect = el.getBoundingClientRect();
            const ripple = document.createElement('div');
            ripple.className = 'ripple';
            ripple.style.left = (e.clientX - rect.left) + 'px';
            ripple.style.top = (e.clientY - rect.top) + 'px';
            el.appendChild(ripple);

            const currQ = game.list[game.idx];
            
            // 记录错题
            if(choice === currQ.a) {
                game.score += 10;
                game.stats[currQ.c]++;
                el.style.borderColor = '#2e7d32'; // 绿
            } else {
                game.wrongList.push({
                    q: currQ.q,
                    my: currQ.o[choice],
                    right: currQ.o[currQ.a]
                });
                el.style.borderColor = '#b22222'; // 红
            }

            // 延迟跳转
            setTimeout(() => {
                game.idx++;
                if(game.idx < 10) {
                    game.render();
                    game.lock = false;
                } else {
                    game.finish();
                }
            }, 400); // 400ms 让用户看清
        },

        finish: () => {
            document.getElementById('progress-bar').style.width = '100%';
            document.getElementById('screen-quiz').classList.remove('active');
            document.getElementById('screen-result').classList.add('active');

            // 计分动画
            const sDiv = document.getElementById('res-score');
            let temp = 0;
            const timer = setInterval(() => {
                if(temp >= game.score) clearInterval(timer);
                else { temp++; sDiv.textContent = temp; }
            }, 20);

            // 评语逻辑
            let seal = "尚需磨练", comment = "乱世凶险，建议您去吴越国避一避。";
            if(game.score === 100) { seal="盖世无双"; comment="阁下真乃神人！若生在五代，定能如赵普般“半部论语治天下”。"; }
            else if(game.score >= 80) { seal="学富五车"; comment="佩服！阁下博古通今，这段乱世风云在您眼中不过是掌上观纹。"; }
            else if(game.score >= 60) { seal="通晓文墨"; comment="及格！看来电视剧您是认真看了，虽有疏漏，但保全性命绰绰有余。"; }
            
            document.getElementById('res-seal').textContent = seal;
            document.getElementById('res-comment').textContent = comment;

            // 倾向分析
            let maxK = Object.keys(game.stats).reduce((a,b)=> game.stats[a]>game.stats[b]?a:b);
            const tags = {1:"乱世生存专家", 2:"钱王知音", 3:"大宋栋梁", 4:"博物君子"};
            document.getElementById('res-tag').textContent = game.stats[maxK]>0 ? `【${tags[maxK]}】属性爆发` : "【初入江湖】";

            // 显示/隐藏错题按钮
            const btnRev = document.getElementById('btn-review');
            btnRev.style.display = game.wrongList.length > 0 ? 'block' : 'none';
        },

        showReview: () => {
            const box = document.getElementById('review-content');
            box.innerHTML = '';
            game.wrongList.forEach(item => {
                const d = document.createElement('div');
                d.className = 'review-item';
                d.innerHTML = `<div class="review-q">${item.q}</div>
                               <div class="review-wrong">误选：${item.my}</div>
                               <div class="review-right">正解：${item.right}</div>`;
                box.appendChild(d);
            });
            document.getElementById('modal-review').classList.add('open');
        }
    };
</script>
</body>
</html>
